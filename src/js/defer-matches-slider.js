const matches = [
  {
    comp_title: "كأس الكونفيدرالية الأفريقية",
    comp_href:
      "https://www.so3ody.com/Competitions/4/كأس-الكونفيدرالية-الأفريقية",

    match_href: "https://www.so3ody.com/matches/2147270856",
    match_title: "الزمالك ضد الشرطة الكيني",
    match_resultBox: "8:00 م",
    match_result: "- : -",

    teamA_img: "https://cdn.so3ody.com/scores/teams/50x50/1060.png",
    teamA_imgAlt: "فريق الزمالك",
    teamA_name: "الزمالك",
    teamA_href: "https://www.so3ody.com/Team/1060/الزمالك",

    teamB_img: "https://cdn.so3ody.com/scores/teams/50x50/28028.png",
    teamB_imgAlt: "فريق الشرطة الكيني",
    teamB_name: "الشرطة الكيني",
    teamB_href: "https://www.so3ody.com/Team/28028/الشرطة-الكيني",
  },
  {
    comp_title: "كأس الكونفيدرالية الأفريقية",
    comp_href:
      "https://www.so3ody.com/Competitions/4/كأس-الكونفيدرالية-الأفريقية",

    match_href: "https://www.so3ody.com/matches/2147270856",
    match_title: "الزمالك ضد الشرطة الكيني",
    match_resultBox: "11:00 ص",
    match_result: "- : -",

    teamA_img: "https://cdn.so3ody.com/scores/teams/50x50/1030.png",
    teamA_imgAlt: "فريق 1",
    teamA_name: "الزمالك",
    teamA_href: "https://www.so3ody.com/Team/1060/الزمالك",

    teamB_img: "https://cdn.so3ody.com/scores/teams/50x50/2028.png",
    teamB_imgAlt: "1",
    teamB_name: "الشرطة الكيني",
    teamB_href: "https://www.so3ody.com/Team/28028/الشرطة-الكيني",
  },
  {
    comp_title: "كأس الكونفيدرالية الأفريقية",
    comp_href:
      "https://www.so3ody.com/Competitions/4/كأس-الكونفيدرالية-الأفريقية",

    match_href: "https://www.so3ody.com/matches/2147270856",
    match_title: "الزمالك ضد الشرطة الكيني",
    match_resultBox: "12:00 م",
    match_result: "- : -",

    teamA_img: "https://cdn.so3ody.com/scores/teams/50x50/1550.png",
    teamA_imgAlt: "فريق 2",
    teamA_name: "الزمالك",
    teamA_href: "https://www.so3ody.com/Team/1060/الزمالك",

    teamB_img: "https://cdn.so3ody.com/scores/teams/50x50/228.png",
    teamB_imgAlt: "2",
    teamB_name: "الشرطة الكيني",
    teamB_href: "https://www.so3ody.com/Team/28028/الشرطة-الكيني",
  },
  {
    comp_title: "كأس الكونفيدرالية الأفريقية",
    comp_href:
      "https://www.so3ody.com/Competitions/4/كأس-الكونفيدرالية-الأفريقية",

    match_href: "https://www.so3ody.com/matches/2147270856",
    match_title: "الزمالك ضد الشرطة الكيني",
    match_resultBox: "5:00 م",
    match_result: "- : -",

    teamA_img: "https://cdn.so3ody.com/scores/teams/50x50/1660.png",
    teamA_imgAlt: "فريق 3",
    teamA_name: "الزمالك",
    teamA_href: "https://www.so3ody.com/Team/1060/الزمالك",

    teamB_img: "https://cdn.so3ody.com/scores/teams/50x50/2028.png",
    teamB_imgAlt: "3",
    teamB_name: "الشرطة الكيني",
    teamB_href: "https://www.so3ody.com/Team/28028/الشرطة-الكيني",
  },
  {
    comp_title: "كأس الكونفيدرالية الأفريقية",
    comp_href:
      "https://www.so3ody.com/Competitions/4/كأس-الكونفيدرالية-الأفريقية",

    match_href: "https://www.so3ody.com/matches/2147270856",
    match_title: "الزمالك ضد الشرطة الكيني",
    match_resultBox: "9:00 م",
    match_result: "- : -",

    teamA_img: "https://cdn.so3ody.com/scores/teams/50x50/1550.png",
    teamA_imgAlt: "فريق 4",
    teamA_name: "الزمالك",
    teamA_href: "https://www.so3ody.com/Team/1060/الزمالك",

    teamB_img: "https://cdn.so3ody.com/scores/teams/50x50/20338.png",
    teamB_imgAlt: "4",
    teamB_name: "الشرطة الكيني",
    teamB_href: "https://www.so3ody.com/Team/28028/الشرطة-الكيني",
  },
  {
    comp_title: "كأس الكونفيدرالية الأفريقية",
    comp_href:
      "https://www.so3ody.com/Competitions/4/كأس-الكونفيدرالية-الأفريقية",

    match_href: "https://www.so3ody.com/matches/2147270856",
    match_title: "الزمالك ضد الشرطة الكيني",
    match_resultBox: "10:00 م",
    match_result: "- : -",

    teamA_img: "https://cdn.so3ody.com/scores/teams/50x50/1230.png",
    teamA_imgAlt: "فريق 5",
    teamA_name: "عالمين",
    teamA_href: "https://www.so3ody.com/Team/1060/الزمالك",

    teamB_img: "https://cdn.so3ody.com/scores/teams/50x50/28.png",
    teamB_imgAlt: "5",
    teamB_name: "فريق النجوم",
    teamB_href: "https://www.so3ody.com/Team/28028/الشرطة-الكيني",
  },
];

const slidesHolder = document.querySelector(".slides-holder");
const prevBtn = document.querySelector(".slider-controllers.prev");
const nextBtn = document.querySelector(".slider-controllers.next");

let currentIndex = 0;
const slideWidth =
  window.innerWidth < 768 ? 100 : window.innerWidth < 1223 ? 50 : 25;
const tail = window.innerWidth < 768 ? 1 : window.innerWidth < 1223 ? 2 : 4;

prevBtn.addEventListener("click", () => {
  if (currentIndex > 0) {
    prevBtn.disabled = false;
    currentIndex--;
    updateSlider();
  }
});

nextBtn.addEventListener("click", () => {
  if (currentIndex < matches.length - tail) {
    nextBtn.disabled = false;
    currentIndex++;
    updateSlider();
  }
});

let startX;

slidesHolder.addEventListener("touchstart", (e) => {
  startX = e.touches[0].clientX;
  slidesHolder.addEventListener("touchmove", throttle(handleDrag, 100));
  slidesHolder.addEventListener("touchend", throttle(handleDrag, 100));
});

slidesHolder.addEventListener("mousedown", (e) => {
  startX = e.clientX;
  slidesHolder.addEventListener("mousemove", throttle(handleDrag, 100));
  slidesHolder.addEventListener("mouseup", throttle(handleDrag, 100));
  slidesHolder.addEventListener("mouseleave", throttle(handleDrag, 100));
});

// clear listeners
window.addEventListener("beforeunload", () => {
  removeAllListeners(prevBtn, "click");
  removeAllListeners(nextBtn, "click");
  removeAllListeners(slidesHolder, "touchstart");
  removeAllListeners(slidesHolder, "touchmove");
  removeAllListeners(slidesHolder, "touchend");
  removeAllListeners(slidesHolder, "mousedown");
  removeAllListeners(slidesHolder, "mousemove");
  removeAllListeners(slidesHolder, "mouseup");
  removeAllListeners(slidesHolder, "mouseleave");
});

// create matches
const matchsFragment = document.createDocumentFragment();
matches.forEach((match) => {
  const newMatch = generateMatchTemplate(match);

  matchsFragment.appendChild(newMatch);
});
slidesHolder.appendChild(matchsFragment);

// functions
function generateMatchTemplate(match) {
  const template = `<div class="slide">
<a title="${match.comp_title}" href="${match.comp_href}">
<p class="matches-slider__head">${match.comp_title}</p></a>
<div class="side-match-box">
  <a href="${match.teamA_href}" class="side-match-box__teamA" >
    <p>${match.teamA_name}</p>
    <img width="25" height="25" title="${match.teamA_name}" data-src="${match.teamA_img}" alt="${match.teamA_imgAlt}" data-ll-status="entered" src="${match.teamA_img}" />
  </a>
  <a class="side-match-box__status" title="${match.match_title}" href="${match.match_href}">
    <div class="side-match-box__result-box">${match.match_resultBox}</div>
    <div class="side-match-box__result">${match.match_result}</div>
  </a>
  <a href="${match.teamB_href}" class="side-match-box__teamB">
    <p>${match.teamB_name}</p>
    <img width="25" height="25" title="${match.teamB_name}" data-src="${match.teamB_img}" alt="${match.teamB_imgAlt}" data-ll-status="entered" src="${match.teamB_img}" />
  </a>
</div>
</div>`;

  const parser = new DOMParser();
  const doc = parser.parseFromString(template, "text/html");
  return doc.body.firstChild;
}
function updateSlider() {
  prevBtn.disabled = currentIndex === 0;
  nextBtn.disabled = currentIndex === matches.length - tail;

  slidesHolder.style.transform = `translateX(${currentIndex * slideWidth}%)`;
}
const handleDrag = (e) => {
  const clientX = e.clientX || e.touches[0].clientX;
  const swipeDistance = clientX - startX;
  const swipeAmount = Math.abs(swipeDistance);

  if (swipeAmount > 50) {
    if (swipeDistance > 0) {
      nextBtn.click();
    } else {
      prevBtn.click();
    }
  }
};